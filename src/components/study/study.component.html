<div class="container py-6">
  <div class="flex justify-between items-center mb-4">
    <h1 class="text-xl font-bold">Há»c bÃ i theo Ä‘á»</h1>
    
    <!-- Page Size Selector -->
    <div class="flex items-center gap-2">
      <label class="text-sm text-gray-600">Hiá»ƒn thá»‹:</label>
      <select [(ngModel)]="pageSize" (ngModelChange)="onPageSizeChange()" class="select-sm">
        <option *ngFor="let size of pageSizeOptions" [value]="size">{{ size }}</option>
      </select>
      <span class="text-sm text-gray-600">Ä‘á»/trang</span>
    </div>
  </div>

  <div class="info-card">
    <h3 class="info-title">ğŸ“š HÆ°á»›ng dáº«n há»c bÃ i</h3>
    <ul class="info-list">
      <li>â€¢ Má»—i Ä‘á» cÃ³ 20 cÃ¢u há»i (Ä‘á» cuá»‘i cÃ³ thá»ƒ Ã­t hÆ¡n)</li>
      <li>â€¢ LÃ m xong sáº½ cÃ³ bÃ¡o cÃ¡o káº¿t quáº£ chi tiáº¿t</li>
      <li>â€¢ Káº¿t quáº£ má»›i sáº½ ghi Ä‘Ã¨ lÃªn káº¿t quáº£ cÅ©</li>
      <li>â€¢ CÃ³ thá»ƒ lÃ m láº¡i nhiá»u láº§n Ä‘á»ƒ cáº£i thiá»‡n Ä‘iá»ƒm sá»‘</li>
      <li>â€¢ <strong>Äá» "Há»c láº¡i cÃ¢u sai"</strong> chá»©a cÃ¡c cÃ¢u Ä‘Ã£ tráº£ lá»i sai, sáº½ tá»± Ä‘á»™ng loáº¡i bá» cÃ¢u khi tráº£ lá»i Ä‘Ãºng</li>
    </ul>
  </div>

  <!-- Category Filter Section -->
  <div class="category-filter-section" *ngIf="availableCategories.length > 0">
    <div class="filter-header">
      <h3 class="filter-title">
        ğŸ·ï¸ Lá»c theo danh má»¥c
      </h3>
      <button 
        class="clear-filters-btn" 
        (click)="clearAllFilters()"
        [disabled]="!hasActiveFilters"
      >
        ğŸ—‘ï¸ XÃ³a bá»™ lá»c
      </button>
    </div>
    
    <div class="category-chips">
      <button
        *ngFor="let category of availableCategories"
        class="category-chip"
        [class.selected]="isCategorySelected(category)"
        [class.unselected]="!isCategorySelected(category)"
        (click)="toggleCategoryFilter(category)"
      >
        <span class="chip-icon">ğŸ“</span>
        <span class="chip-text">{{ category }}</span>
      </button>
      
      <!-- Special chip for wrong answers if it exists -->
      <button
        *ngIf="wrongAnswersSetExists"
        class="category-chip"
        [class.selected]="isCategorySelected('CÃ¢u há»i sai')"
        [class.unselected]="!isCategorySelected('CÃ¢u há»i sai')"
        (click)="toggleCategoryFilter('CÃ¢u há»i sai')"
      >
        <span class="chip-icon">ğŸ”„</span>
        <span class="chip-text">CÃ¢u há»i sai</span>
      </button>
    </div>
    
    <div *ngIf="hasActiveFilters" class="filter-status">
      ğŸ“Š Äang hiá»ƒn thá»‹ {{ filteredStudySets.length }} Ä‘á» tá»« {{ selectedCategories.size }} danh má»¥c Ä‘Ã£ chá»n
    </div>
  </div>

  <!-- No Categories Message -->
  <div class="category-filter-section" *ngIf="availableCategories.length === 0 && !isLoading">
    <div class="no-categories">
      ğŸ“‚ ChÆ°a cÃ³ danh má»¥c nÃ o. HÃ£y thÃªm cÃ¢u há»i vá»›i danh má»¥c Ä‘á»ƒ sá»­ dá»¥ng tÃ­nh nÄƒng lá»c.
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="text-center py-8">
    <div class="inline-flex items-center gap-3">
      <div class="loading-spinner"></div>
      <span class="text-gray-600">Äang táº£i dá»¯ liá»‡u...</span>
    </div>
  </div>

  <!-- Study Sets Grid -->
  <div *ngIf="!isLoading" class="study-grid">
    <div *ngFor="let set of paginatedStudySets" 
         class="study-card" 
         [class.wrong-answers-card]="set._id === 'wrong-answers-set'">
      
      <div class="card-header">
        <div class="card-title">
          <h3 class="set-name">
            {{ set.name }}
            <span *ngIf="set._id === 'wrong-answers-set'" class="wrong-answers-badge">ğŸ”„</span>
          </h3>
          <p class="set-info">{{ set.questions.length }} cÃ¢u há»i</p>
        </div>
        
        <div class="card-score">
          <div *ngIf="getSetResult(set._id) as result" class="score-display">
            <div class="score-percentage"
                 [class.score-excellent]="result.score >= 0.8"
                 [class.score-good]="result.score >= 0.5 && result.score < 0.8"
                 [class.score-poor]="result.score < 0.5">
              {{ result.score * 100 | number : "1.0-0" }}%
            </div>
            <div class="score-details">
              {{ result.score * result.totalQuestions | number : "1.0-0" }}/{{ result.totalQuestions }}
            </div>
            <div class="score-date">
              {{ result.completedAt | date : "dd/MM HH:mm" }}
            </div>
          </div>
          
          <div *ngIf="!getSetResult(set._id)" class="no-score">
            <div class="no-score-icon">ğŸ“</div>
            <div class="no-score-text">ChÆ°a lÃ m</div>
          </div>
        </div>
      </div>

      <div class="card-content">
        <div class="categories-section">
          <div class="categories-label">Danh má»¥c:</div>
          <div class="categories-list">
            <span *ngFor="let category of getCategories(set)"
                  class="category-tag"
                  [class.wrong-answers-tag]="set._id === 'wrong-answers-set'">
              {{ category }}
            </span>
          </div>
        </div>

        <div class="progress-section" *ngIf="getSetResult(set._id) as result">
          <div class="progress-bar">
            <div class="progress-fill"
                 [style.width.%]="result.score * 100"
                 [class.progress-excellent]="result.score >= 0.8"
                 [class.progress-good]="result.score >= 0.5 && result.score < 0.8"
                 [class.progress-poor]="result.score < 0.5"
                 [class.progress-wrong-answers]="set._id === 'wrong-answers-set'">
            </div>
          </div>
        </div>
      </div>

      <div class="card-actions">
        <!-- Start Button - when never attempted -->
        <button *ngIf="!getSetResult(set._id)"
                class="action-btn"
                [class.btn-start]="set._id !== 'wrong-answers-set'"
                [class.btn-wrong-answers]="set._id === 'wrong-answers-set'"
                [disabled]="isButtonLoading(set._id)"
                (click)="startStudySet(set)">
          <div *ngIf="isButtonLoading(set._id)" class="loading-spinner"></div>
          <span *ngIf="!isButtonLoading(set._id)" class="btn-icon">
            {{ set._id === 'wrong-answers-set' ? 'ğŸ”„' : 'ğŸš€' }}
          </span>
          <span class="btn-text">
            {{ set._id === 'wrong-answers-set' ? 'Há»c láº¡i' : 'Báº¯t Ä‘áº§u' }}
          </span>
        </button>

        <!-- Review and Retake Buttons - when already attempted -->
        <div *ngIf="getSetResult(set._id)" class="action-buttons-group">
          <button class="action-btn btn-review"
                  [disabled]="isButtonLoading(set._id + '-review')"
                  (click)="reviewStudySet(set)">
            <div *ngIf="isButtonLoading(set._id + '-review')" class="loading-spinner"></div>
            <span *ngIf="!isButtonLoading(set._id + '-review')" class="btn-icon">ğŸ‘ï¸</span>
            <span class="btn-text">Xem láº¡i</span>
          </button>

          <button class="action-btn"
                  [class.btn-retake]="set._id !== 'wrong-answers-set'"
                  [class.btn-wrong-answers]="set._id === 'wrong-answers-set'"
                  [disabled]="isButtonLoading(set._id + '-retake')"
                  (click)="confirmRetakeStudySet(set)">
            <div *ngIf="isButtonLoading(set._id + '-retake')" class="loading-spinner"></div>
            <span *ngIf="!isButtonLoading(set._id + '-retake')" class="btn-icon">ğŸ”„</span>
            <span class="btn-text">LÃ m láº¡i</span>
          </button>
        </div>

        <!-- Retake Incorrect Answers Button -->
        <div *ngIf="getSetResult(set._id) && hasIncorrectAnswers(set._id) && set._id !== 'wrong-answers-set'">
          <button class="action-btn btn-warning"
                  [disabled]="isButtonLoading(set._id + '-incorrect')"
                  (click)="retakeIncorrectAnswers(set)">
            <div *ngIf="isButtonLoading(set._id + '-incorrect')" class="loading-spinner"></div>
            <span *ngIf="!isButtonLoading(set._id + '-incorrect')" class="btn-icon">âš ï¸</span>
            <span class="btn-text">LÃ m láº¡i cÃ¡c cÃ¢u sai</span>
          </button>
        </div>

        <!-- Clear Wrong Answers Button -->
        <div *ngIf="set._id === 'wrong-answers-set'">
          <button class="action-btn btn-clear-wrong"
                  [disabled]="isButtonLoading('wrong-answers-set-clear')"
                  (click)="confirmClearWrongAnswers()">
            <div *ngIf="isButtonLoading('wrong-answers-set-clear')" class="loading-spinner"></div>
            <span *ngIf="!isButtonLoading('wrong-answers-set-clear')" class="btn-icon">ğŸ—‘ï¸</span>
            <span class="btn-text">XÃ³a Ä‘á» nÃ y</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Pagination -->
  <div class="pagination-controls" *ngIf="!isLoading && totalPages > 1">
    <button
      class="btn btn-outline btn-sm"
      (click)="changePage(-1)"
      [disabled]="currentPage === 1"
    >
      â¬…ï¸ TrÆ°á»›c
    </button>
    <div class="pagination-info">
      Trang {{ currentPage }} / {{ totalPages }} ({{ filteredStudySets.length }} Ä‘á»)
    </div>
    <button
      class="btn btn-outline btn-sm"
      (click)="changePage(1)"
      [disabled]="currentPage === totalPages"
    >
      Tiáº¿p â¡ï¸
    </button>
  </div>

  <!-- Empty State -->
  <div *ngIf="!isLoading && studySets.length === 0" class="empty-state">
    <div class="empty-icon">ğŸ“š</div>
    <h3 class="empty-title">ChÆ°a cÃ³ cÃ¢u há»i nÃ o</h3>
    <p class="empty-description">ThÃªm cÃ¢u há»i Ä‘á»ƒ báº¯t Ä‘áº§u há»c bÃ i</p>
    <button class="btn btn-primary" (click)="router.navigate(['/questions'])">
      ThÃªm cÃ¢u há»i
    </button>
  </div>
</div>